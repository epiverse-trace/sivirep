---
title: "An谩lisis o reportes personalizados"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An谩lisis o reportes personalizados}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

A continuaci贸n se describe un conjunto b谩sico de instrucciones para usar
`sivirep` 0.0.9 si: - Ya has producido un archivo .Rmd y deseas editar
un reporte. - Deseas realizar an谩lisis personalizados sin un archivo
.Rmd.

### Configuraci贸n

Puedes instalar la versi贸n de desarrollo de `sivirep` desde GitHub con
el siguiente comando:

```{r setup_sivirep, eval = FALSE}
install.packages("pak")
pak::pak("epiverse-trace/sivirep")
```

Despu茅s de la instalaci贸n de `sivirep`, puedes comenzar importando el
paquete a trav茅s del siguiente comando:

```{r import_sivirep}
library(sivirep)
```

### 1. Importaci贸n de datos de SIVIGILA

La fuente de SIVIGILA proporciona los datos de la lista de casos
hist贸ricos hasta el 煤ltimo a帽o epidemiol贸gico cerrado. El cierre de un
a帽o epidemiol贸gico generalmente ocurre en abril del siguiente a帽o (por
ejemplo, si est谩s utilizando `sivirep` en marzo de 2023, es posible que
puedas acceder a los datos hist贸ricos hasta diciembre de 2021) para la
mayor铆a de las enfermedades, con algunas excepciones.

Por favor, verifica las enfermedades y a帽os disponibles utilizando:

```{r eventos, results = 'hide'}
lista_eventos <- list_events()
```

Una vez que hayas decidido la enfermedad y el a帽o de la cual deseas
obtener la informaci贸n, `import_data_event` es la funci贸n que permite la
importaci贸n de datos desde la fuente de SIVIGILA utilizando un formato
parametrizado basado en la enfermedad y el a帽o.

```{r import_data_event}
data_event <-  import_data_event(year = 2020,
                                 nombre_event = "Dengue")
```

#####  Tip 1 - Evita retrasos en el tiempo al importar los datos

-   `sivirep` 0.0.9 est谩 dise帽ado para ayudar con el acceso a la fuente
    de SIVIGILA. Este proceso de descarga de informaci贸n puede tomar
    unos minutos dependiendo del tama帽o del conjunto de datos. Para
    evitar descargar los mismos datos repetidamente, puedes utilizar
    `cache = TRUE` en la funci贸n `import_data_event`. Esta opci贸n est谩
    configurada de forma predeterminada.

### 2. Limpieza de datos de SIVIGILA

Los datos de SIVIGILA son una fuente de informaci贸n oficial altamente
confiable, con certificaci贸n ISO de calidad de datos. Sin embargo, a
veces puede haber algunos valores at铆picos en los datos que requieran
una limpieza adicional.

`sivirep` proporciona una funci贸n gen茅rica llamada
`limpiar_data_sivigila` que envuelve diversas tareas para identificar y
corregir errores, inconsistencias y discrepancias en los conjuntos de
datos con el fin de mejorar su calidad y precisi贸n. Este proceso puede
incluir la eliminaci贸n de duplicados, la correcci贸n de errores
tipogr谩ficos, el reemplazo de valores faltantes y la validaci贸n de
datos, entre otras tareas, como eliminar fechas improbables, limpiar
c贸digos de geolocalizaci贸n y estandarizar los nombres de las columnas y
las categor铆as de edad.

```{r limpiar_data_sivigila}
data_event <- limpiar_data_sivigila(data_event = data_event)
```

Las funciones de limpieza dentro de `limpiar_data_sivigila` se han
recopilado y creado en base a la experiencia de epidemi贸logos de campo.
Estas pueden incluir funciones internas como:

-   `limpiar_encabezado`: funci贸n que limpia y estandariza los nombres
    de las columnas de los datos de lista de casos de SIVIGILA bas谩ndose
    en el diccionario de datos de SIVIGILA.

-   `limpiar_edad_event`: funci贸n que limpia las edades de los datos de
    lista de casos de SIVIGILA.

-   `limpiar_fecha_event`: funci贸n que limpia las fechas de los datos de
    enfermedades.

-   `limpiar_cods_dpto`: funci贸n que limpia los c贸digos geogr谩ficos de
    departamentos en los datos de enfermedades.

El usuario puede utilizar estas funciones individualmente o simplemente
utilizar la funci贸n envolvente gen茅rica `limpiar_data_sivigila`.

### 3. Filtrar casos

`sivirep` proporciona una funci贸n que permite filtrar los datos de
enfermedades por departamento o nombre del municipio llamada
`geo_filtro`. Esto permite al usuario crear un informe a nivel
subnacional, seleccionando casos espec铆ficos basados en la ubicaci贸n
geogr谩fica.

```{r geo_filtro}
data_event_filtrada <- geo_filtro(data_event = data_event,
                                  dpto = "Choco")
```

### 4. Distribuci贸n temporal de casos

En `sivirep`, la distribuci贸n temporal de casos se define por las
variables de fecha de inicio de s铆ntomas y fecha de notificaci贸n. Para
cada una de estas variables, existen funciones especializadas para
agrupar los datos y generar los gr谩ficos.

#### 4.1. Agrupar los datos por fecha de inicio de s铆ntomas en la escala temporal deseada

Para generar la distribuci贸n de casos por fecha de inicio de s铆ntomas,
es necesario agrupar los datos por estas variables. `sivirep`
proporciona una funci贸n que permite esta agrupaci贸n llamada
`agrupar_fecha_inisintomas`.

```{r agrupar_fecha_inicio_sintomas}
casos_ini_sintomas <- agrupar_fecha_inisintomas(data_event =
                                                  data_event)
```

#####  Tip 2 - Obt茅n los primeros n meses con m谩s casos

-   Al construir una secci贸n del reporte o analizar estos datos, puede
    ser 煤til obtener los meses con m谩s casos. En `sivirep`, puedes
    utilizar la funci贸n `obtener_meses_mas_casos` para obtener esta
    informaci贸n.

El gr谩fico que permite visualizar esta distribuci贸n se debe generar con
la funci贸n `plot_fecha_inisintomas`. Ten en cuenta que, incluso si has
agrupado los datos por d铆a, es posible que prefieras representarlo por
semana epidemiol贸gica, como en:

```{r plot_fecha_inicio_sintomas, fig.height = 5, fig.width = 10}
plot_fecha_inisintomas(data_agrupada = casos_ini_sintomas,
                       uni_marca = "semanaepi")
```

#### 4.2. Agrupar los datos por fecha de notificaci贸n en la escala temporal deseada

El proceso para generar la distribuci贸n de casos por fecha de
notificaci贸n consiste en agrupar los datos de enfermedades por esta
variable. Puedes utilizar la siguiente funci贸n de `sivirep` para hacer
esto:

```{r agrupar_fecha_notificacion}
casos_fecha_notificacion <- agrupar_fecha_notifica(data_event =
                                                     data_event)
```

El gr谩fico que permite visualizar esta distribuci贸n debe generarse con
la funci贸n `plot_fecha_notifica`. Ten en cuenta que, aunque hayas
agrupado los datos por d铆a, es posible que prefieras representarlos por
semana epidemiol贸gica, como en:

```{r plot_fecha_notificacion, fig.height = 5, fig.width = 10}
plot_fecha_notifica(data_agrupada = casos_fecha_notificacion,
                    uni_marca = "semanaepi")
```

### 5. Edad y sexo

### 5.1. Variable de sexo

Cuando se analizan o se informan datos de enfermedades, a menudo es
necesario determinar la distribuci贸n de casos por g茅nero o sexo. Sin
embargo, la fuente de SIVIGILA solo registra el sexo.

`sivirep` proporciona una funci贸n que agrega y calcula autom谩ticamente
los porcentajes por sexo despu茅s del proceso de limpieza.

```{r agrupar_sexo}
casos_sex <- agrupar_sex(data_event = data_event,
                         porcentaje = TRUE)
```

Adem谩s, `sivirep` cuenta con una funci贸n para generar el gr谩fico por
esta variable llamada `plot_sex`:

```{r plot_sexo, fig.height = 5, fig.width = 8}
plot_sex(data_agrupada = casos_sex)
```

La distribuci贸n de casos por sexo y semana epidemiol贸gica se puede
generar utilizando la funci贸n `agrupar_sex_semanaepi` proporcionada por
`sivirep`.

```{r agrupar_sex_semana_epidemiologica}
casos_sex_semanaepi <- agrupar_sex_semanaepi(data_event = data_event)
```

La funci贸n de visualizaci贸n correspondiente es `plot_sex_semanaepi`, que
`sivirep` proporciona para mostrar la distribuci贸n de casos por sexo y
semana epidemiol贸gica.

```{r plot_sex_semana_epidemiologica, fig.height = 9, fig.width = 11}
plot_sex_semanaepi(data_agrupada = casos_sex_semanaepi)
```

### 5.2. Variable de edad

La edad es una variable importante para analizar, ya que es un factor de
riesgo conocido para muchas enfermedades. Ciertas enfermedades y
condiciones tienden a ocurrir con m谩s frecuencia en grupos de edad
espec铆ficos, y esta distribuci贸n puede ayudar a identificar poblaciones
con mayor riesgo e implementar estrategias de prevenci贸n y control
dirigidas.

`sivirep` proporciona una funci贸n llamada `agrupar_edad`, que puede
agrupar los datos de enfermedades por grupos de edad. De forma
predeterminada, esta funci贸n produce rangos de edad con intervalos de 10
a帽os. Adem谩s, los usuarios pueden personalizar un rango de edad
diferente.

```{r agrupar_edad}
casos_edad <- agrupar_edad(data_event = data_event, interval_edad = 10)
```

La funci贸n de visualizaci贸n correspondiente es `plot_edad`.

```{r plot_edad, fig.height = 3, fig.width = 8}
plot_edad(data_agrupada = casos_edad)
```

### 5.3. Edad y sexo simult谩neamente

`sivirep` proporciona una funci贸n llamada `agrupar_edad_sex`, que puede
agrupar los datos de enfermedades por rangos de edad y sexo de forma
simult谩nea y obtener el n煤mero de casos y los porcentajes
correspondientes. Adem谩s, permite personalizar el intervalo de edad.

```{r agrupar_edad_sexo}
casos_edad_sex <- agrupar_edad_sex(data_event = data_event,
                                   interval_edad = 10)

```

La funci贸n de visualizaci贸n correspondiente es `plot_edad_sex`.

```{r plot_edad_sexo, fig.height = 3, fig.width = 9}
plot_edad_sex(data_agrupada = casos_edad_sex)
```

### 6. Distribuci贸n espacial de casos

Obtener la distribuci贸n espacial de los casos es 煤til para identificar
谩reas con una alta concentraci贸n de casos, agrupaciones de enfermedades
y factores de riesgo ambientales o sociales.

En Colombia, existen 32 unidades geogr谩ficas administrativas (adm1)
llamadas departamentos. `sivirep` proporciona una funci贸n llamada
`agrupar_mpio` que permite obtener un data.frame de casos agrupados por
departamento o municipio.

```{r agrupar_municipios}
dist_esp_dept <- agrupar_mpio(data_event = data_event_filtrada,
                             dpto = "Choco")
```

Actualmente, con la funci贸n llamada `plot_map`, el usuario puede generar
un mapa est谩tico de Colombia que muestra la distribuci贸n de casos por
departamentos y municipios.

```{r plot_mapa, results = 'hide', echo = TRUE, error = FALSE, warning = FALSE, include = FALSE, message = FALSE}
mapa <- plot_map(data_agrupada = dist_esp_dept, dpto = "Choco", col_distribucion = "casos")
```

```{r mapa, fig.height = 14, fig.width = 10}
mapa
```

#####  Tip 3 - Obt茅n la fila con m谩s casos

- Al construir una secci贸n del reporte o analizar estos datos, puede ser 煤til saber cu谩l es la variable que tiene la mayor铆a de los casos. En `sivirep`, puedes utilizar la funci贸n `obtener_fila_mas_casos` para obtener esta informaci贸n. Esta funci贸n funciona con cualquier conjunto de datos que contenga una columna llamada "casos" en cualquier nivel de agregaci贸n.
